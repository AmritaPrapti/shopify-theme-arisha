{{ 'build-own-bundle.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
<script src="{{ 'build-own-bundle.js' | asset_url }}" defer></script>


{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<section class="color-{{ section.settings.color_scheme }} " style="--quantity-button:{{ section.settings.quantity_button_color}}; --font-family: {{ section.settings.font_family }};">
  <div class="section-{{ section.id }}-padding page-width" 
    data-progress-bar-color="{{ section.settings.progress_bar_color }}"
    data-success-color="{{ section.settings.success_message_color }}"
    data-empty-heading-color="{{ section.settings.empty_heading_color }}"
    data-empty-subtitle-color="{{ section.settings.empty_subtitle_color }}"
    data-empty-heading-text="{{ section.settings.empty_heading_text }}"
    data-empty-subtitle-text="{{ section.settings.empty_subtitle_text }}"
    data-add-to-cart-bg="{{ section.settings.add_to_cart_bg }}"
    data-add-to-cart-text="{{ section.settings.add_to_cart_text }}"
    data-discount-tiers='[{% for block in section.blocks %}{% if forloop.first == false %},{% endif %}{"minQuantity":{{ block.settings.min_quantity }},"discountText":"{{ block.settings.discount_text }}"}{% endfor %}]'>

    <div class="bundle-header">
      {% if section.settings.heading != blank %}
        <h2 class="bundle-heading">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.details != blank %}
        <div class="bundle-details">{{ section.settings.details }}</div>
      {% endif %}
    </div>

    <!-- Discount Tiers Steps -->
    {% if section.blocks.size > 0 %}
    <div class="discount-tiers-steps" id="discount-tiers-steps">
      <div class="tier-step tier-start active">
        <div class="tier-step-circle">0</div>
        <div class="tier-step-label">Start</div>
        <div class="tier-step-discount">No discount</div>
      </div>
      {% for block in section.blocks %}
        <div class="tier-step-connector"></div>
        <div class="tier-step" data-min-quantity="{{ block.settings.min_quantity }}">
          <div class="tier-step-circle">{{ block.settings.min_quantity }}</div>
          <div class="tier-step-label">{{ block.settings.min_quantity }}+ Products</div>
          <div class="tier-step-discount">{{ block.settings.discount_text }}</div>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="bundle-products-container">
        <div class="bundle-products-wrapper">
          <div class="bundle-products active">
            {% assign collection = section.settings.collection %}
            {% if collection != blank %}
              {% paginate collection.products by 50 %}
                <div class="bundle-product-grid">
                  {% for product in collection.products %}
                    {% render 'bundle-product-card', card_product: product, settings: section.settings %}
                  {% endfor %}
                </div>
              {% endpaginate %}
            {% else %}
              <p>Please select a collection for the bundle.</p>
            {% endif %}
          </div>
        </div>
        <div class="selected-product-summary-wrapper">
          <div class="selected-product-summary">
            <!-- Summary content will be populated by JavaScript -->
          </div>
        </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Build Your Own Bundle",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "font_picker",
      "id": "font_family",
      "label": "Choose a font family for the section",
      "default": "quattrocento_sans_n4"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Product Collection",
      "info": "Choose a collection to pull products from for the bundle."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Build Your Own Bundle",
      "info": "The heading text for the section."
    },
    {
      "type": "richtext",
      "id": "details",
      "label": "Section Details",
      "default": "<p></p>"
    },
    {
      "type": "header",
      "content": "Color settings"
    },
    {
        "type": "color",
        "id": "button_background",
        "label": "Button Background",
        "default": "#CC858F"
    },
    {
        "type": "color",
        "id": "button_text_color",
        "label": "Button Text Color",
        "default": "#FFFFFF",
        "info": "Set the text color for the button."
    },
    {
        "type": "color",
        "id": "quantity_button_color",
        "label": "Quantity Button Color",
        "default": "#CC858F",
        "info": "Set the color for the quantity buttons."
    },
    {
        "type": "color",
        "id": "progress_bar_color",
        "label": "Progress Bar Color",
        "default": "#4caf50",
        "info": "Set the color for the bundle progress bar."
    },
    {
        "type": "color",
        "id": "success_message_color",
        "label": "Success Message Color",
        "default": "#4caf50",
        "info": "Set the color for success messages."
    },
    {
        "type": "color",
        "id": "empty_heading_color",
        "label": "Empty State Heading Color",
        "default": "#333333",
        "info": "Set the heading color for empty bundle state."
    },
    {
        "type": "color",
        "id": "empty_subtitle_color",
        "label": "Empty State Subtitle Color",
        "default": "#666666",
        "info": "Set the subtitle color for empty bundle state."
    },
    {
        "type": "color",
        "id": "add_to_cart_bg",
        "label": "Add to Cart Button Background",
        "default": "#CC858F",
        "info": "Set the background color for add to cart button."
    },
    {
        "type": "color",
        "id": "add_to_cart_text",
        "label": "Add to Cart Button Text Color",
        "default": "#FFFFFF",
        "info": "Set the text color for add to cart button."
    },
    {
      "type": "header",
      "content": "Custom text settings"
    },
    {
        "type": "text",
        "id": "empty_heading_text",
        "label": "Empty State Heading",
        "default": "Your Bundle is Empty",
        "info": "The heading text shown when bundle is empty."
    },
    {
        "type": "text",
        "id": "empty_subtitle_text",
        "label": "Empty State Subtitle",
        "default": "Start adding products to build your custom bundle",
        "info": "The subtitle text shown when bundle is empty."
    },
    {
      "type": "text",
      "id": "add_to_cart_label",
      "label": "Add to Cart Button Label",
      "default": "Add bundle to Cart",
      "info": "The label text shown on the add to cart button.",
      "placeholder": "Add to Cart"
    },
    {
      "type": "header",
      "content": "Spacing settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 20
    }
  ],
  "blocks": [
    {
      "name": "Discount Tier",
      "type": "discount_tier",
      "settings": [
        {
          "type": "number",
          "id": "min_quantity",
          "label": "Minimum Quantity",
          "default": 14,
          "info": "Minimum number of products required for this discount tier."
        },
        {
          "type": "text",
          "id": "discount_text",
          "label": "Discount Text",
          "default": "10% off",
          "info": "The discount text to display (e.g., '10% off', '15% discount')."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Build Your Own Bundle",
      "category": "Product",
      "blocks": [
        {
          "type": "discount_tier",
          "settings": {
            "min_quantity": 14,
            "discount_text": "10% off"
          }
        },
        {
          "type": "discount_tier",
          "settings": {
            "min_quantity": 22,
            "discount_text": "15% off"
          }
        }
      ]
    }
  ]
}
{% endschema %}
